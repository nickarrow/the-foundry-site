---
import { getAllContentFiles } from '../lib/content';

interface Props {
  slug: string;
}

const { slug } = Astro.props;
const base = import.meta.env.BASE_URL;

// Get all valid page slugs
const allFiles = getAllContentFiles();
const validSlugs = new Set(allFiles.map(f => f.slug));

// Build breadcrumb trail from slug
const parts = slug ? slug.split('/').filter(p => p) : [];
const crumbs: { name: string; href: string | null }[] = [
  { name: 'Home', href: base }
];

let currentPath = '';
for (const part of parts) {
  currentPath += (currentPath ? '/' : '') + part;
  // Convert slug back to readable name
  const name = part
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ')
    .replace(/\d+\.\s*/, ''); // Remove leading numbers like "1. "
  
  // Only make it a link if there's an actual page at this path
  const href = validSlugs.has(currentPath) ? `${base}/${currentPath}` : null;
  crumbs.push({ name, href });
}
---

<nav class="breadcrumbs" aria-label="Breadcrumb">
  <ol>
    {crumbs.map((crumb, i) => (
      <li>
        {i < crumbs.length - 1 ? (
          <>
            {crumb.href ? (
              <a href={crumb.href}>{crumb.name}</a>
            ) : (
              <span class="folder">{crumb.name}</span>
            )}
            <span class="separator">/</span>
          </>
        ) : (
          <span class="current">{crumb.name}</span>
        )}
      </li>
    ))}
  </ol>
</nav>

<style>
  .breadcrumbs {
    font-size: 0.85rem;
    margin-bottom: 1rem;
    color: var(--text-muted);
  }
  
  ol {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 0.25rem;
  }
  
  li {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  a {
    color: var(--link-color);
    text-decoration: none;
  }
  
  a:hover {
    text-decoration: underline;
  }
  
  .separator {
    color: var(--text-muted);
    opacity: 0.5;
  }
  
  .folder {
    color: var(--text-secondary);
  }
  
  .current {
    color: var(--text-primary);
  }
</style>
