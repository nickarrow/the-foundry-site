---
interface Props {
  name: string;
  rank: string;
  progress: number;
  trackType?: string;
  complete?: boolean;
}

const { name, rank, progress, trackType = 'Vow', complete = false } = Astro.props;

// Progress is stored as ticks (0-40), convert to boxes (0-10)
const ticks = progress;
const fullBoxes = Math.floor(ticks / 4);
const remainingTicks = ticks % 4;

// Calculate the data-value for each box (0-4 ticks)
function getBoxValue(boxIndex: number): number {
  if (boxIndex < fullBoxes) return 4;
  if (boxIndex === fullBoxes) return remainingTicks;
  return 0;
}

// Format rank for display (capitalize first letter)
const displayRank = rank.charAt(0).toUpperCase() + rank.slice(1).toLowerCase();
---

<div class="iron-vault-track" data-rank={rank} data-complete={complete}>
  <div class="track-type">{trackType.toUpperCase()}</div>
  <div class="track-rank">{displayRank.toUpperCase()}</div>
  <div class="track-name">{name}</div>
  <div class="track-widget">
    <ol>
      {Array.from({ length: 10 }, (_, i) => (
        <li data-value={getBoxValue(i)}>{getBoxValue(i)}</li>
      ))}
    </ol>
  </div>
  <div class="track-progress">{fullBoxes}/10 ({ticks} ticks)</div>
</div>
